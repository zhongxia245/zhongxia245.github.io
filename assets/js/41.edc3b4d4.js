(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{223:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("用简单的语言和案例告诉你『JavaScript 是如何工作的』的一个良心教程。\n"),a("a",{attrs:{href:"https://www.youtube.com/watch?v=8aGhZQkoFbQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("《Youtube=>菲利普·罗伯茨：到底什么是 Event Loop 呢？ | 欧洲 JSConf 2014》"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("a",{attrs:{href:"http://latentflip.com/loupe/",target:"_blank",rel:"noopener noreferrer"}},[t._v("《可视化调用栈如何运行的网站》"),a("OutboundLink")],1)]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("一步一步带你了解 JavaScript 是如何运行的。")]),t._v(" "),a("h2",{attrs:{id:"q1：javascript-引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q1：javascript-引擎"}},[t._v("#")]),t._v(" Q1：JavaScript 引擎")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("JavaScript引擎")]),t._v("是一个专门处理"),a("code",[t._v("JavaScript脚本")]),t._v("的"),a("code",[t._v("虚拟机")]),t._v("，一般会附带在网页浏览器之中。 ----维基百科")])]),t._v(" "),a("p",[t._v("JS 引擎的具体内容，不是这篇文章的重点，本文知道它是用来解释，执行 JS 代码的就可以了。")]),t._v(" "),a("p",[t._v("JS 引擎有很多个，但是用的最多，性能最好的是 Google 用 C++开发的 V8 引擎， 下文的例子实在 Chrome 上运行的。")]),t._v(" "),a("h2",{attrs:{id:"q2：浏览器运行时环境组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q2：浏览器运行时环境组成"}},[t._v("#")]),t._v(" Q2：浏览器运行时环境组成")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/12/05/5c079cfa41bb0.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("事件循环（Event Loop）: 处理主线程（V8 引擎的代码执行线程）和其他线程的通讯")]),t._v(" "),a("li",[t._v("JS 引擎（V8）：解释、执行 JS 代码")]),t._v(" "),a("li",[t._v("WebAPIs：浏览器提供的一些 API（DOM 操作，异步，定时器等）")]),t._v(" "),a("li",[t._v("回调队列（Callback Queue）：回调函数在这里排队，等待主线程翻牌子。")])]),t._v(" "),a("h3",{attrs:{id:"_2-1、event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、event-loop"}},[t._v("#")]),t._v(" 2.1、Event Loop")]),t._v(" "),a("p",[t._v("简单理解，"),a("code",[t._v("Event Loop")]),t._v(" 就是负责主线程合其他进程之间的通讯的线程栗子。")]),t._v(" "),a("p",[t._v("看个栗子：")]),t._v(" "),a("blockquote",[a("p",[t._v("这个栗子来源"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/10/event_loop.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《什么是 Event Loop？》"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("如果某个任务很耗时，比如涉及很多 I/O（输入/输出）操作，那么线程的运行大概是下面的样子。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/2013102002.png",alt:""}})]),t._v(" "),a("p",[t._v("上图的绿色部分是程序的运行时间，红色部分是等待时间。可以看到，由于 I/O 操作很慢，所以这个线程的大部分运行时间都在空等 I/O 操作的返回结果。这种运行方式称为"),a("code",[t._v('"同步模式"（synchronous I/O）')]),t._v("或"),a("code",[t._v('"堵塞模式"（blocking I/O）')]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("Event Loop")]),t._v("就是为了解决这个问题而提出的。")]),t._v(" "),a("blockquote",[a("p",[t._v('"Event Loop 是一个程序结构，用于等待、发送消息和事件。（a programming construct that waits for and dispatches events or messages in a program.）"')])]),t._v(" "),a("p",[t._v('简单说，就是在程序中设置两个线程：一个负责程序本身的运行，称为"主线程"；另一个负责主线程与其他进程、线程（主要是各种 I/O 操作）的通信，被称为"Event Loop 线程"（可以译为"消息线程"）。')]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/2013102004.png",alt:""}})]),t._v(" "),a("p",[t._v("上图主线程的绿色部分，还是表示运行时间，而橙色部分表示空闲时间。每当遇到 I/O 的时候，主线程就让 Event Loop 线程去通知相应的 I/O 程序，然后接着往后运行，所以不存在红色的等待时间。等到 I/O 程序完成操作，Event Loop 线程再把结果返回主线程。主线程就调用事先设定的回调函数，完成整个任务。")]),t._v(" "),a("p",[t._v('可以看到，由于多出了橙色的空闲时间，所以主线程得以运行更多的任务，这就提高了效率。这种运行方式称为"异步模式"（asynchronous I/O）或"非堵塞模式"（non-blocking mode）。')]),t._v(" "),a("blockquote",[a("p",[t._v("上面这段是搬过来的内容")])]),t._v(" "),a("h3",{attrs:{id:"_2-2、-js-引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、-js-引擎"}},[t._v("#")]),t._v(" 2.2、 JS 引擎")]),t._v(" "),a("p",[t._v("JS 引擎的两个重要组成部分")]),t._v(" "),a("h4",{attrs:{id:"_1-内存堆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-内存堆"}},[t._v("#")]),t._v(" 1. 内存堆")]),t._v(" "),a("p",[t._v("计算机程序在运行期中动态分配使用内存（比如，"),a("code",[t._v("let list = [1,2,3,4,5]")]),t._v(", list 变量的值就存放在内存堆里面）")]),t._v(" "),a("h4",{attrs:{id:"_2-调用栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-调用栈"}},[t._v("#")]),t._v(" 2. 调用栈")]),t._v(" "),a("p",[t._v("调用栈是解析器(如浏览器中的的 javascript 解析器)的一种机制，可以在脚本调用多个函数时，跟踪每个函数在完成执行时应该返回控制的点。（如什么函数正在执行，什么函数被这个函数调用，下一个调用的函数是谁）")]),t._v(" "),a("p",[t._v("参考：https://developer.mozilla.org/zh-CN/docs/Glossary/Call_stack")]),t._v(" "),a("p",[t._v("PS：讲一堆理论看不懂什么鬼，来点实在的例子吧。")]),t._v(" "),a("ol",[a("li",[t._v("举个栗子：")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sayHi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sayHi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("执行步骤描述如下：")]),t._v(" "),a("ol",[a("li",[t._v("函数声明，变量定义先不管")]),t._v(" "),a("li",[t._v("执行到 "),a("code",[t._v("greeting()")]),t._v(", 压入栈中")]),t._v(" "),a("li",[a("code",[t._v("greeting")]),t._v(" 中调用了 "),a("code",[t._v("sayHi()")]),t._v("， 把 "),a("code",[t._v("sayHi()")]),t._v(" 压入栈中")]),t._v(" "),a("li",[a("code",[t._v("sayHi")]),t._v(" 中执行 "),a("code",[t._v("console.log")]),t._v("，压入栈中")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("console.log('hi')")]),t._v(", 控制台看到 Hi，把 "),a("code",[t._v("console.log")]),t._v(" 从栈中删除")]),t._v(" "),a("li",[a("code",[t._v("sayHi")]),t._v(" 执行结束，把 "),a("code",[t._v("sayHi")]),t._v(" 从栈中删除")]),t._v(" "),a("li",[a("code",[t._v("greeting")]),t._v(" 执行结束，把 "),a("code",[t._v("greeting")]),t._v(" 从栈中删除")]),t._v(" "),a("li",[t._v("本次执行结束（栈为空）")])]),t._v(" "),a("p",[t._v("调用栈可视化图如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_stack.gif",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("再来个栗子：")])]),t._v(" "),a("p",[t._v("控制台，打印出的报错信息其实就是栈的内容。")]),t._v(" "),a("p",[t._v("foo 报错了，是谁调用了 foo 呢，看这个栈就可以了解了")]),t._v(" "),a("p",[t._v("匿名函数 => baz => bar => foo")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/12/05/5c07d541595f4.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("再来个死循环的栗子，看在调用栈是怎么表现的")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 死循环")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("栈的大小是有限制的，死循环后，一直压入栈，栈就会被撑爆了。 然后浏览器就报"),a("code",[t._v("栈溢出")]),t._v("错误了")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/12/05/5c07d6100ea8d.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"q3：单线程没有异步操作的话，多个-http-请求-或-io-操作-是什么样的？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q3：单线程没有异步操作的话，多个-http-请求-或-io-操作-是什么样的？"}},[t._v("#")]),t._v(" Q3：单线程没有异步操作的话，多个 HTTP 请求(或 IO 操作)是什么样的？")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 假装HTTP请求")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'//foo.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bar "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'//bar.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" qux "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'//qux.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("执行步骤描述：")]),t._v(" "),a("ol",[a("li",[t._v("获取 "),a("code",[t._v("foo.com")]),t._v("的数据")]),t._v(" "),a("li",[t._v("等 1 获取到数据，开始获取 "),a("code",[t._v("bar.com")]),t._v(" 的数据")]),t._v(" "),a("li",[t._v("等 2 获取到数据，开始获取 "),a("code",[t._v("qux.com")]),t._v(" 的数据")]),t._v(" "),a("li",[t._v("输出数据")])]),t._v(" "),a("p",[t._v("总运行时间：1 + 2 + 3 + 4 的时间")]),t._v(" "),a("p",[t._v("每次操作一下，页面就卡住了，等执行完，才继续操作。")]),t._v(" "),a("p",[t._v("所以光靠单线程来执行代码，体验不好，只能做页面显示和一些简单交互。")]),t._v(" "),a("p",[t._v("就像这个图：\n"),a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_sync.gif",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"q4：同步获取数据在有什么问题？-》-阻塞问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q4：同步获取数据在有什么问题？-》-阻塞问题"}},[t._v("#")]),t._v(" Q4：同步获取数据在有什么问题？ ==》 阻塞问题")]),t._v(" "),a("p",[t._v("JavaScript 是单线程的语言，执行同步请求（或者耗时操作）的时候，页面就卡住了，等请求结束，页面才可以操作， 这种现象叫『阻塞（Blocking）』。")]),t._v(" "),a("p",[t._v("阻塞后，页面就卡住了，这种体验极差。")]),t._v(" "),a("h2",{attrs:{id:"q5：-阻塞问题什么解决呢？-》-异步操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q5：-阻塞问题什么解决呢？-》-异步操作"}},[t._v("#")]),t._v(" Q5： 阻塞问题什么解决呢？==》 异步操作")]),t._v(" "),a("ol",[a("li",[t._v("异步操作在调用栈什么样的呢？")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'I am a setTimeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("执行步骤描述：")]),t._v(" "),a("ol",[a("li",[t._v("执行 "),a("code",[t._v("console.log('Hi')")]),t._v(" [压入栈，执行，执行完，从栈中删除（后面同样操作，统一说『执行』）]")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("setTimeout")]),t._v("， 检测到是浏览器提供的 API，因此交给浏览器的线程去执行，主线程继续往下执行。")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("console.log('end')")])]),t._v(" "),a("li",[t._v("等待浏览器线程处理异步操作完成（注意：异步代码执行 和 "),a("code",[t._v("步骤3")]),t._v(" 是"),a("code",[t._v("并行")]),t._v("的）")]),t._v(" "),a("li",[t._v("浏览器线程 处理 "),a("code",[t._v("setTimeout")]),t._v(" 结束，就会把相应的回调函数放到 "),a("code",[t._v("回调队列（Calback Queue）")]),t._v("中，等待主线程翻牌子")]),t._v(" "),a("li",[t._v("主线程调用栈为空时，会去判断"),a("code",[t._v("回调队列")]),t._v("是否有函数需要执行， 有则拿出回调函数，压入到"),a("code",[t._v("调用栈")]),t._v("去执行，没有就等会再来看看。")]),t._v(" "),a("li",[t._v("执行回调函数")]),t._v(" "),a("li",[t._v("执行 "),a("code",[t._v("console.log('I am a setTimeout')")])]),t._v(" "),a("li",[t._v("结束，调用栈为空")])]),t._v(" "),a("p",[t._v("调用栈的顺序就像这个图：\n"),a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_async.gif",alt:"setTimeuot异步操作"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Ajax 异步操作，调用栈顺序如图：【和上面 setTimeout 异步操作的顺序是一样的】")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_asycn_ajax.gif",alt:"Ajax异步操作"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("如果有多个异步操作呢？")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("可以看到两点：")]),t._v(" "),a("ol",[a("li",[t._v("异步操作是并发执行的")]),t._v(" "),a("li",[t._v("异步回调执行的先后顺序跟 "),a("code",[t._v("Callback Queue")]),t._v("的排队顺序有关")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_mul_async.gif",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"q6：dom-api-操作，调用栈又是什么样的？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q6：dom-api-操作，调用栈又是什么样的？"}},[t._v("#")]),t._v(" Q6：DOM API 操作，调用栈又是什么样的？")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'button'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btn click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'settimetout 5000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("从图中可以看出，")]),t._v(" "),a("ol",[a("li",[t._v("DOM 点击事件的监听，会一直在 浏览器线程里面运行着")])]),t._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("点击 DOM，则把点击的回调函数放到 "),a("code",[t._v("Callback Queue")])])])])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("多次点击，回调函数会在"),a("code",[t._v("Callback Queue")]),t._v(" 排队等待主线程调用栈为空时，来拿回调函数去执行。")])]),t._v(" "),a("blockquote",[a("p",[t._v("除了 DOM 事件一直在浏览器线程监听着外，其他和上面异步操作的执行方式一样")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://static.izhongxia.com/pictures/blog_dom_click.gif",alt:""}})]),t._v(" "),a("p",[t._v("到这里，已经大概了解 JavaScript 代码在浏览器下如何运行的，有了一个基本的认识。")]),t._v(" "),a("p",[t._v("下面是一些小思考。")]),t._v(" "),a("h2",{attrs:{id:"q7：javascript-是单线程，又是异步的，这两者有冲突吗？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q7：javascript-是单线程，又是异步的，这两者有冲突吗？"}},[t._v("#")]),t._v(" Q7：JavaScript 是单线程，又是异步的，这两者有冲突吗？")]),t._v(" "),a("ul",[a("li",[t._v("单线程"),a("br"),t._v("\n因为 JavaScript 引擎只有一个主线程在执行 JS 的代码，所以同一时刻只会有一段代码在执行。")]),t._v(" "),a("li",[t._v("异步操作"),a("br"),t._v("\n异步操作是浏览器的多个常驻线程去执行的, 这个是浏览器的行为。")])]),t._v(" "),a("p",[t._v("举个栗子："),a("br"),t._v("\n异步 Http 请求，是浏览器的"),a("code",[t._v("执行线程")]),t._v(" 和 "),a("code",[t._v("事件触发线程")]),t._v("共同完成的， 执行线程去执行异步请求， 事件触发线程监测 异步请求是否完成，完成则把回调函数插入 回调队列(Callback Queue)，JS 引擎主线程在执行完调用栈的函数后（调用栈为空时），会去查看 回调队列是否有需要执行的回调，有则一个一个拿出来执行，没有就等一会儿在来看。")]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=8aGhZQkoFbQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("《【Youtube 视频】菲利普·罗伯茨：到底什么是 Event Loop 呢？ | 欧洲 JSConf 2014》"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/10/event_loop.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《什么是 Event Loop？》"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Glossary/Call_stack",target:"_blank",rel:"noopener noreferrer"}},[t._v("《【MDN】调用栈\n》"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop",target:"_blank",rel:"noopener noreferrer"}},[t._v("《并发模型与事件循环\n》"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);