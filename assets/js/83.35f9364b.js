(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{215:function(t,a,e){"use strict";e.r(a);var s=e(0),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"source-map-的原理探究"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#source-map-的原理探究"}},[t._v("#")]),t._v(" source map 的原理探究")]),t._v(" "),e("p",[t._v("在现在的前端开发中，最终部署上线的是使用压缩的代码。压缩的代码，可以减少文件的体积，加快页面的打开速度。 但是对于开发人员的调试就是一个噩梦了。")]),t._v(" "),e("p",[t._v("因此出现了 SourceMap 映射文件，再压缩代码的时候，生成对应的映射文件。")]),t._v(" "),e("p",[e("strong",[t._v("压缩代码 + 映射文件 = 源码（可以还原出源码）")])]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("简单理解："),e("strong",[t._v("把源码 和 输出文件（压缩的代码）的映射关系记录下来。")])]),t._v(" "),e("p",[t._v("举个例子：")]),t._v(" "),e("blockquote",[e("p",[t._v("“feel the force” （源码） ⇒ Yoda ⇒ “the force feel” （输出的代码）")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Output location")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Input")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Input location")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Character")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 0")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("t")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 6")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("h")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 7")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("e")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 4")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 9")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("f")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 5")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 10")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("o")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 6")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 11")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("r")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 7")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 12")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("c")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 8")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 13")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("e")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 10")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 0")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("f")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 11")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("e")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 12")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("e")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 13")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Yoda_input.txt")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Line 1, Column 3")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("l")])])])]),t._v(" "),e("p",[t._v("得出来的映射关系类似下面这样，通过这个映射关系，就可以得出源代码。")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Mappings")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("283")]),t._v(" chars length"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Yoda_input"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("原理是这样，剩下的"),e("strong",[t._v("就是对这个映射关系做优化")]),t._v("。不然就上面一行字符串，映射关系都这么复杂的话，要是代码复杂的话，那生成的映射关系得多大？")]),t._v(" "),e("h2",{attrs:{id:"sourcemap-生成步骤？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sourcemap-生成步骤？"}},[t._v("#")]),t._v(" SourceMap 生成步骤？")]),t._v(" "),e("p",[t._v("把上面的映射关系经过以下步骤优化，最终得出我们生产环境用的 SourceMap。")]),t._v(" "),e("ol",[e("li",[e("p",[e("strong",[t._v("省去输出文件中的行号")])]),t._v(" "),e("p",[t._v("输出的文件，经过压缩，行号都是1，因此映射关系中的 1，就可以去掉")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("可符号化字符的提取")])]),t._v(" "),e("p",[t._v("上面的例子，记录的是每一个字符。 但是压缩代码并不会对代码中的单词也压缩掉，因此可以把每一个字符，换成字符串。 比如 "),e("code",[t._v("feel，the， force")]),t._v("。 这样就可以省下很多映射关系。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("记录相对位置")])]),t._v(" "),e("p",[t._v("如果代码很多的话，那么列数可能很多位（eg:50000+）, 这样记录映射关系中很多一部分都是这些数字，占用很多空间。 因为映射关系式有顺序的，因此使用相对位置的话，就会节省很多空间。")]),t._v(" "),e("p",[t._v("eg: 1|4|10 => 1|3|6    （1 | 1+3 | 1+3+6 ）")])]),t._v(" "),e("li",[e("p",[t._v("**VLQ（Variable Length Quantities）优化 **")]),t._v(" "),e("p",[t._v("用 VLQ 的方式记录相对位置，再转换成二进制表示。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("Base64 转换")])]),t._v(" "),e("p",[t._v("把二进制变成 base64的值，节省空间。比如 000001变成对应字母。")])])]),t._v(" "),e("p",[t._v("具体的信息，可以看下面的参考文章，讲的很清楚了，这里就不再讲一遍了。")]),t._v(" "),e("h2",{attrs:{id:"参考文章"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://www.cnblogs.com/Wayou/p/understanding_frontend_source_map.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《source map 的原理探究》"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/archive/blogs/davidni/source-maps-under-the-hood-vlq-base64-and-yoda",target:"_blank",rel:"noopener noreferrer"}},[t._v("《Source Maps under the hood – VLQ, Base64 and Yoda》"),e("OutboundLink")],1)])]),t._v(" "),e("blockquote",[e("p",[t._v("这两个是同一个文章，只是一个是英文版，一个是汉化版")])])])}),[],!1,null,null,null);a.default=n.exports}}]);