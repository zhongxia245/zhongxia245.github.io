(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{203:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"js-生成图片的调研"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-生成图片的调研"}},[t._v("#")]),t._v(" JS 生成图片的调研")]),t._v(" "),a("p",[t._v("从社区里面找来下，大部分使用这两个库可以完成生成图片的功能。 "),a("a",{attrs:{href:"https://github.com/tsayen/dom-to-image",target:"_blank",rel:"noopener noreferrer"}},[t._v("dom2image"),a("OutboundLink")],1),t._v(" , "),a("a",{attrs:{href:"https://github.com/niklasvh/html2canvas",target:"_blank",rel:"noopener noreferrer"}},[t._v("html2canvas"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("很早就知道这两个库，知道有兼容性问题，但是不太清楚具体的问题多有哪些，因此有了这篇文章。")]),t._v(" "),a("h2",{attrs:{id:"零、结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#零、结果"}},[t._v("#")]),t._v(" 零、结果")]),t._v(" "),a("p",[t._v("整理测试结果，结果表示 "),a("code",[t._v("html2canvas")]),t._v(" 的效果会比 "),a("code",[t._v("dom2image")]),t._v(" 兼容性和失真程度好一点。")]),t._v(" "),a("blockquote",[a("p",[t._v("还没有去研究 dom2image 是否可以提高图片清晰度，因此结果只能作为参考。")])]),t._v(" "),a("h2",{attrs:{id:"一、测试测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、测试测试"}},[t._v("#")]),t._v(" 一、测试测试")]),t._v(" "),a("p",[t._v("想尝试，可以打开这个 "),a("a",{attrs:{href:"https://zhongxia245.github.io/demo/pages/dom2image/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试地址"),a("OutboundLink")],1),t._v(" ， 想看源码，看这里 "),a("a",{attrs:{href:"https://github.com/zhongxia245/demo/tree/master/src/pages/dom2image",target:"_blank",rel:"noopener noreferrer"}},[t._v("源码"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("测试机器,只有这两部了")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Iphone7, IOS12.4.1")])]),t._v(" "),a("li",[a("p",[t._v("Android , Huawei Mate 9 , Android9")])])])]),t._v(" "),a("li",[a("p",[t._v("测试分为 5 个环境，")]),t._v(" "),a("ul",[a("li",[t._v("PC，")]),t._v(" "),a("li",[t._v("wechat（IOS,Android）")]),t._v(" "),a("li",[t._v("webview（IOS，Android）\n"),a("ul",[a("li",[t._v("webview 为公司客户端内的 webview， IOS 使用 UIWebview，Android WkWebview。")])])])])]),t._v(" "),a("li",[a("p",[t._v("以下结果为页面超过一屏的测试结果。")])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("功能")]),t._v(" "),a("th",[t._v("PC")]),t._v(" "),a("th",[t._v("wechat ios")]),t._v(" "),a("th",[t._v("wechat android")]),t._v(" "),a("th",[t._v("IOS")]),t._v(" "),a("th",[t._v("Android")]),t._v(" "),a("th",[t._v("其他")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("dom2image 下载图片")]),t._v(" "),a("td",[t._v("可以下载")]),t._v(" "),a("td",[t._v("不可以下载")]),t._v(" "),a("td",[t._v("不可以，只能长按保存")]),t._v(" "),a("td",[t._v("不可以")]),t._v(" "),a("td",[t._v("不可以")]),t._v(" "),a("td",[t._v("移动端无法下载文件")])]),t._v(" "),a("tr",[a("td",[t._v("dom2image 保存为 SVG")]),t._v(" "),a("td",[t._v("可以，不失真")]),t._v(" "),a("td",[t._v("部分内容丢失，不失真，可以长按保存,svg")]),t._v(" "),a("td",[t._v("部分内容丢失，不失真，svg")]),t._v(" "),a("td",[t._v("部分内容丢失，不失真，svg 格式")]),t._v(" "),a("td",[t._v("可以，不失真，svg")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("dom2image 保存为 PNG")]),t._v(" "),a("td",[t._v("可以，失真严重")]),t._v(" "),a("td",[t._v("可以，失真严重，可以长按保存,base64")]),t._v(" "),a("td",[t._v("无法生成")]),t._v(" "),a("td",[t._v("部分内容丢失，不失真，可以长按保存")]),t._v(" "),a("td",[t._v("可以，失真严重，base64")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("html2canvas 保存为 SVG")]),t._v(" "),a("td",[t._v("可以，稍微失真")]),t._v(" "),a("td",[t._v("可以，稍微失真，可以长按保存, base64")]),t._v(" "),a("td",[t._v("可以，稍微失真，base64")]),t._v(" "),a("td",[t._v("可以，稍微失真,base64")]),t._v(" "),a("td",[t._v("可以，稍微失真，base64")]),t._v(" "),a("td")])])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("部分内容丢失")]),t._v("：有可能是丢失图片，丢失页面按钮，或者其他元素，没有规律，因此统一称 部分内容丢失。")]),t._v(" "),a("p",[t._v("**失真：**即页面上看着清晰，保存成图片后，看起来模糊。【非像素眼看着都模糊了，那是真的模糊了】")]),t._v(" "),a("p",[a("strong",[t._v("base64, svg")]),t._v(" : 生成出来的图片格式, base64 、svg 格式")])]),t._v(" "),a("h2",{attrs:{id:"二、测试结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、测试结果"}},[t._v("#")]),t._v(" 二、测试结果")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("dom2image")]),t._v(" , "),a("code",[t._v("html2canvas")]),t._v(" 都可以使用本地图片，和七牛图片（七牛图片，需要七牛设置支持 CROS）")]),t._v(" "),a("li",[t._v("内容只有一屏，则不会出现内容丢失的问题，超过一屏则会存在各种丢失内容的问题，丢失内容规律暂时没有找到")]),t._v(" "),a("li",[t._v("她理财 android 分享 base64 图片有问题，选择分享微信好友后，没有反应 ， IOS 没有问题")]),t._v(" "),a("li",[t._v("如果页面中存在图片，偶尔会丢失（本地图片，和七牛七牛，都有可能丢失）")])]),t._v(" "),a("h2",{attrs:{id:"三、采用的截图方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、采用的截图方案"}},[t._v("#")]),t._v(" 三、采用的截图方案")]),t._v(" "),a("p",[t._v("由于 "),a("code",[t._v("dom2Image")]),t._v(" 保存的 png 图片，存在严重失真，并且保存的 svg 图片虽然很清晰，但是客户端的分享功能，不支持 svg 模式，因此采用 "),a("code",[t._v("html2canvas")]),t._v(" .")]),t._v(" "),a("p",[t._v("采用 "),a("code",[t._v("html2canvas")]),t._v(" 方案， 测试可用性， 如果页面内容在一屏之内，测试结果如下")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("wechat ios")]),t._v("： 可以")]),t._v(" "),a("li",[a("code",[t._v("webivew ios:")]),t._v(" 可以， 图片偶尔会丢失，偶发")]),t._v(" "),a("li",[a("code",[t._v("wechat android")]),t._v("， 可以")]),t._v(" "),a("li",[a("code",[t._v("webview android")]),t._v("： 可以")])]),t._v(" "),a("h3",{attrs:{id:"_3-1、页面中存在跨域的图片如何处理？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、页面中存在跨域的图片如何处理？"}},[t._v("#")]),t._v(" 3.1、页面中存在跨域的图片如何处理？")]),t._v(" "),a("p",[a("code",[t._v("html2Canvas")]),t._v(" 请求非同域名的图片，如何支持生成 base64")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" html2canvas "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"html2canvas"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Modal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Button"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Toast "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"antd-mobile"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .... 省略代码")]),t._v("\n\nToast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loading")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"正在生成图片..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("html2canvas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  useCORS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加上这个才能使用七牛上的图片地址，并且七牛需要设置好 CROS")]),t._v("\n  logging"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("canvas")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Toast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果不设置 useCORS , 存在跨域图片，这里会报错")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toDataURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Modal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img style"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" width"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100%"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("dataUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("h3",{attrs:{id:"_3-2、pc-端可以生成图片，并下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、pc-端可以生成图片，并下载"}},[t._v("#")]),t._v(" 3.2、PC 端可以生成图片，并下载")]),t._v(" "),a("blockquote",[a("p",[t._v("这里以 dom2image 为例，主要展示触发下载保存功能，而不是如何截图")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("dom2Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSvg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("dataUrl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Toast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发下载保存图片功能")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"download"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo.png"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"href"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3-3、html2canvas-截图模糊的解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3、html2canvas-截图模糊的解决方案"}},[t._v("#")]),t._v(" 3.3、html2canvas 截图模糊的解决方案")]),t._v(" "),a("p",[t._v("解决方案的原理，就是把 canvas 的大小变成页面元素的两倍。和页面上使用两倍图的原理是一样的。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*图片跨域及截图模糊处理*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" shareContent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" domObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//需要截图的包裹的（原生的）DOM 对象")]),t._v("\n  width "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientWidth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//shareContent.offsetWidth; //获取dom 宽度")]),t._v("\n  height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//shareContent.offsetHeight; //获取dom 高度")]),t._v("\n  canvas "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canvas"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建一个canvas节点")]),t._v("\n  scale "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义任意放大倍数 支持小数")]),t._v("\ncanvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" width "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" scale "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义canvas 宽度 * 缩放")]),t._v("\ncanvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" scale "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义canvas高度 *缩放")]),t._v("\ncanvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientWidth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" scale "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),t._v("\ncanvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" scale "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),t._v("\ncanvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2d"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scale")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scale"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" scale"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取context,设置scale")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  scale"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" scale"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 添加的scale 参数")]),t._v("\n  canvas"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" canvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自定义 canvas")]),t._v("\n  logging"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//日志开关，便于查看html2canvas的内部执行流程")]),t._v("\n  width"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" width"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//dom 原始宽度")]),t._v("\n  height"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  useCORS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 【重要】开启跨域配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("html2canvas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("canvas")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toDataURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);