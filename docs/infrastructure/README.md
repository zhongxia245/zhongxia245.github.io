# 前端基础建设

一个前端工程师，天然会在职业不同阶段，处在 技术型选手、业务型选手、管理型选手 交叉的象限中。

无论是哪一种选手，从初级迈向技术专家的路程上，除了做业务和管理外，具备前端基建方法论都是一个能力刚需。



这里主要介绍下都有什么类型的基础建设，没有就得实施方案。



## 一、基础建设都需要哪些部分？

### 1.1、高优先级

1. 版本管理：Gitlab
2. 持续集成：CI/CD + 自建 CI server + runner
3. 统一无配置 webpack 脚手架
4. 部署平台
5. 日志平台（百度统计，谷歌统计，自建日志系统（kibana））
6. 错误监控（sentry， 自建错误统计平台）



### 1.2、可选

1. 运营活动平台
2. 可视化后台系统
3. 自建 UI 组件库



## 二、优先级高的前端基础设施

#### 1.1.1、版本管理：Gitlab

代码是公司的私有资产，正常企业都不会把代码放在别人的服务器上，因此自己搭建一个管理代码的。

目前最常用的是 gitlab , 也有用 svn 的。

gitlab 如何搭建看 gitlab 官网即可。



#### 2.2、持续集成

git 提交代码后，可以通过 CI/CD 配置需要执行的命令

比如：eslint 检查，代码构建，自动部署上线



部署上线需要看项目的部署环境。从进入公司到现在，部署方式可以分为三个阶段

第一阶段：CI/CD 只有 eslint 和 构建，然后把构建的资源手动上传到云服务器，实现部署

第二阶段：CI/CD 只有 eslint 和 构建，然后实现一个部署后台，自动下载构建的资源，然后可视化上传到云服务器，实现部署

第三节点：CI/CD 直接实现，eslint , 构建静态资源，构建docker 包， 部署docker 上线 的操作。



> 如何构建 docker 包，如果把 docker 包部署起来，这个需要 K8S 的基础设施。当然部署 docker 并不是简单的把 docker 启动起来，需要分配 docker 端口，需要为每个运行起来的 docker 分配域名，需要支持自定义 nginx 配置等等。
>
> 不过这些可能需要运维同学来弄，或者专门研究下。（目前只是运用了现成的基础设施）



#### 2.3、统一无配置 webpack 脚手架

如果公司只有一个项目，那么这个倒没有那么重要，但是正常公司都会有很多项目，或者说技术人员会把一个大的项目，拆分成很多个子项目。

如果项目脚手架需要升级，那么多个项目如果统一升级呢？每个项目都改一遍配置，这个费时费力，并且不靠谱。

解决这个问题，我司也走了很多步

1. 前后端未分离（前端 react+ webpack + gulp ， 后端 python）
2. 前后端分离，各个项目都有自己的 webpack 配置（前端后分离是一个一个项目来，所以配置不一样）
3. 自己封装 global-fe 脚手架（封装 webpack 配置），其他逻辑项目都 软链到 global-fe 的 src 目录下，这样就保证所有逻辑项目都有统一的 webpack配置
4. 基于 蚂蚁金服开源的 umi 框架，封装适合自己的插件，无缝迁移之前运用 global-fe 的代码。



#### .4、部署平台

部署的环境分为，测试环境，预发布环境，线上环境

部署平台需要支持快速回滚版本，方便上线有问题，快速回滚到老版本。

> 目前我们使用的是，每个特定分支的 commit 会构建出一个 独立docker，因此回滚只需要改变部署之前那个 commit 的 生成的 docker 即可。



#### 2.5、日志平台

页面部署上线了，页面的 PV，UV, 某个按钮的点击次数，用户点击路径等等，让数据分析师有数据可分析。

如果只是简单的看访问量，可以用 百度统计，谷歌统计

如果想要自己搭建日志平台，可以使用开源的 kibana



#### 2.6、错误监控

代码部署上线了，并不是就结束了，需要做的线上的代码是不是有报错，什么系统，什么用户，哪行代码报错，错误是什么？

> 虽然测试同学测试通过才能上线，但是测试通过并不是就一定没有 bug 了，有可能用于用户设备版本低，网络问题，瞎操作什么的，导致报错。

错误监控有几个需要注意的问题

1. 现在上传的代码都是经过构建压缩的，直接看压缩代码，很难定位具体哪个代码报错，因为需要和 source map 做映射。
2. 如何监听获取错误信息，最简单的是 监听 window.onerror
3. 错误统计，需要抽样上交。





## 三、可选部分

### 3.1、运营活动系统

如果公司的运营活动特别多，并且运营活动是有规律的（客户同学来来回回就是那么几个模式换着来做活动）。

比如运营活动，主要目的是 拉新，促销，提升用户活跃度，然后活动的形式，来来回回就是那么几个。因此我们可以做 一个运营活动平台，然后抽象除一些常用的功能模块，通过可视化配置，完成活动开发。



### 3.2、可视化后台系统

一个业务需求，如果做出来了，需要长期运营的话，那么正常都会 有一个管理后台让运营同学和产品来管理数据。

一个需求对应一个后台，那么要是来10个需求，那么不是要做10个后台？每个后台的页面，还基本都是增删改查。做这些属于技术难度低，技术成长低的工作。

可以创建一个可视化后台，后端同学写完接口，再通过简单的可视化配置，就能完成 CRUD 页面的开发。不用说这个后台系统可以配置100%的需求，只要解决80%常规的 CRUD 页面，就可以节省很多时间。

> 目前我司的可视化后台，已经有4个业务线，采用该平台，配置了将近200个后台页面了。



### 3.3、自建 UI 组件库

这个最好喝设计师沟通下，封装一些常用的组件。之后设计师涉及的时候，有现成的，可以直接用现成的，同样的，前端也可以直接用。这样可以提升一些效率。



> 弹窗，关闭按钮，有时候在右上角，有时候在弹窗下中间位置，经常不一样，导致每次弹窗都需要重新写，非常麻烦。如果约定好了，使用弹窗，只要写好文案，就 ok 了，这样大家都方便，设计快，开发也快。



